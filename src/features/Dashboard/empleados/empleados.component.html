<app-dashboard-layout>
  <div class="employees-container">
    <!-- Header Section -->
    <div class="content-header">
      <h1 class="page-title">
        <i class="pi pi-users"></i>
        Gestión de Empleados
      </h1>
      <p class="page-subtitle">Administra los empleados de tu taller mecánico</p>

      <div class="header-actions">
        <p-button
          label="Nuevo Empleado"
          icon="pi pi-plus"
          severity="success"
          (onClick)="openNew()"
          class="new-button">
        </p-button>
      </div>
    </div>

    <!-- Table Section -->
    <div class="table-container">
      <p-table
        [value]="employees()"
        [loading]="loading()"
        [paginator]="true"
        [rows]="10"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} empleados"
        [rowsPerPageOptions]="[5, 10, 25]"
        styleClass="p-datatable-sm"
        responsiveLayout="scroll">

        <ng-template pTemplate="header">
          <tr>
            <th>ID</th>
            <th>Nombre Completo</th>
            <th>Email</th>
            <th>Teléfono</th>
            <th>Cargo</th>
            <th>Fecha de Registro</th>
            <th>Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-employee>
          <tr>
            <td>{{ employee.employees_id }}</td>
            <td>
              <span class="employee-name">
                {{ employee.person?.name }} {{ employee.person?.last_name }}
              </span>
            </td>
            <td>
              <span class="employee-email">{{ employee.person?.email }}</span>
            </td>
            <td>
              <span class="employee-phone">{{ employee.person?.cellphone_number }}</span>
            </td>
            <td>
              <p-tag
                value="Sin cargo asignado"
                severity="warning"
                styleClass="position-tag">
              </p-tag>
            </td>
            <td>{{ formatDate(employee.created_at) }}</td>
            <td>
              <div class="action-buttons">
                <p-button
                  icon="pi pi-pencil"
                  severity="info"
                  size="small"
                  [text]="true"
                  [rounded]="true"
                  pTooltip="Editar"
                  (onClick)="editEmployee(employee)">
                </p-button>
                <p-button
                  icon="pi pi-trash"
                  severity="danger"
                  size="small"
                  [text]="true"
                  [rounded]="true"
                  pTooltip="Eliminar"
                  (onClick)="deleteEmployee(employee)">
                </p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center">
              <div class="empty-state">
                <i class="pi pi-users" style="font-size: 3rem; color: #6b7280;"></i>
                <p>No hay empleados registrados</p>
                <p-button
                  label="Crear Primer Empleado"
                  icon="pi pi-plus"
                  severity="success"
                  (onClick)="openNew()">
                </p-button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Dialog for Create/Edit Employee -->
    <p-dialog
      [(visible)]="employeeDialogVisible"
      [header]="isEditing() ? 'Editar Empleado' : 'Nuevo Empleado'"
      [modal]="true"
      [closable]="false"
      [style]="{width: '500px'}"
      styleClass="employee-dialog">

      <div class="dialog-content">
        <div class="form-grid">
          <div class="field">
            <label for="employeeName" class="field-label">
              Nombre <span class="required">*</span>
            </label>
            <input
              pInputText
              id="employeeName"
              [(ngModel)]="currentEmployee.name"
              placeholder="Nombre del empleado"
              class="form-input"
              maxlength="50"
              [autofocus]="true" />
          </div>

          <div class="field">
            <label for="employeeLastName" class="field-label">
              Apellido <span class="required">*</span>
            </label>
            <input
              pInputText
              id="employeeLastName"
              [(ngModel)]="currentEmployee.last_name"
              placeholder="Apellido del empleado"
              class="form-input"
              maxlength="50" />
          </div>

          <div class="field">
            <label for="employeeEmail" class="field-label">
              Email <span class="required">*</span>
            </label>
            <input
              pInputText
              id="employeeEmail"
              type="email"
              [(ngModel)]="currentEmployee.email"
              placeholder="ejemplo@correo.com"
              class="form-input"
              maxlength="100" />
          </div>

          <div class="field">
            <label for="employeePhone" class="field-label">
              Teléfono <span class="required">*</span>
            </label>
            <input
              pInputText
              id="employeePhone"
              [(ngModel)]="currentEmployee.cellphone_number"
              placeholder="Número de teléfono"
              class="form-input"
              maxlength="15" />
          </div>

          <div class="field">
            <label for="employeePosition" class="field-label">
              Cargo <span class="required">*</span>
            </label>
            <p-dropdown
              [options]="positionOptions"
              [(ngModel)]="currentEmployee.positions_id"
              placeholder="Selecciona un cargo"
              [showClear]="true"
              styleClass="form-dropdown">
            </p-dropdown>
          </div>
        </div>
      </div>

      <ng-template pTemplate="footer">
        <div class="dialog-footer">
          <p-button
            label="Cancelar"
            icon="pi pi-times"
            [text]="true"
            severity="secondary"
            (onClick)="hideDialog()">
          </p-button>
          <p-button
            [label]="isEditing() ? 'Actualizar' : 'Crear'"
            [icon]="isEditing() ? 'pi pi-check' : 'pi pi-plus'"
            severity="success"
            (onClick)="saveEmployee()">
          </p-button>
        </div>
      </ng-template>
    </p-dialog>

    <!-- Toast Messages -->
    <p-toast position="top-right"></p-toast>

    <!-- Confirmation Dialog -->
    <p-confirmDialog
      styleClass="confirm-dialog"
      [style]="{width: '425px'}">
    </p-confirmDialog>
  </div>
</app-dashboard-layout>
